
================================================================
  ProxRssi Unit Tests (Hampel + EMA + Features + State Machine)
================================================================

[TEST] Init defaults
  PASS: Init defaults

[TEST] Init NULL safety
  PASS: Init NULL safety

[TEST] PushRaw clamping
  PASS: PushRaw clamping

[TEST] Hampel rejects single spike
    EMA before: -800 Q4, after: -800 Q4, jump: 0 Q4 (0.0 dB)
  PASS: Hampel rejects single spike

[TEST] Hampel passes clean signal
    EMA: -720 Q4 (-45.0 dBm), expected: -720 Q4, diff: 0 Q4
  PASS: Hampel passes clean signal

[TEST] EMA converges to stable input
    EMA after 30 samples of -55: -55.0 dBm (diff: 0.0 dB)
  PASS: EMA converges to stable input

[TEST] EMA resets on time anomaly (dt > 2s)
    Before gap: -40.0 dBm, After gap+(-80 x10): -80.0 dBm
  PASS: EMA resets on time anomaly

[TEST] Feature extraction: stable signal
    StdDev(Q4)=0 (0.0 dB), PctAbove(Q15)=32767, n=21
  PASS: Feature extraction: stable signal

[TEST] FAR -> CANDIDATE when RSSI >= enterNear
    State: CANDIDATE, Last event: CANDIDATE_STARTED
  PASS: FAR -> CANDIDATE

[TEST] CANDIDATE -> LOCKOUT after 2s stable
    State: LOCKOUT, Event: UNLOCK_TRIGGERED
  PASS: CANDIDATE -> LOCKOUT after 2s stable

[TEST] CANDIDATE -> FAR (exit confirmation 1.5s)
    State after approach: CANDIDATE
    State after -85 x30: FAR, event: EXIT_TO_FAR
  PASS: CANDIDATE -> FAR (exit confirmation)

[TEST] Exit confirmation resets when signal recovers
    State after approach: CANDIDATE
    State after brief dip + recovery: CANDIDATE
  PASS: Exit confirmation resets on recovery

[TEST] Lockout period (5s after unlock)
    State 2s after unlock: LOCKOUT
  PASS: Lockout period

[TEST] Lockout expires, then locks if signal weak
    State after lockout + exit confirm: FAR, event: EXIT_TO_FAR
  PASS: Lockout expires, then locks

[TEST] No flip-flop between thresholds
    State at -55 dBm (in band): FAR
  PASS: No flip-flop in hysteresis band

[TEST] Unstable signal does not unlock
    State after 4s noisy: CANDIDATE
  PASS: Unstable signal does not unlock

[TEST] ForceFar resets to FAR
  PASS: ForceFar resets to FAR

[TEST] Full lifecycle
    Step 1 (far):       FAR
    Step 2 (unlock):    LOCKOUT
    Step 3 (lockout):   LOCKOUT
    Step 4 (lock):      FAR
    Step 5 (re-unlock): LOCKOUT
  PASS: Full lifecycle

[TEST] Q4 conversion helpers
  PASS: Q4 conversion helpers

================================================================
  Results: 19 passed, 0 failed, 19 total
================================================================

